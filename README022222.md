# 药品知识库向量检索评估系统

这是一个用于评估向量模型在药品知识库检索任务上性能的系统。系统使用大规模语言模型生成的向量表示，结合FAISS向量数据库进行高效的相似度检索。

## 功能特点

- 支持多种向量模型（当前使用 gte_Qwen2-1.5B-instruct）
- 使用FAISS进行高效向量检索
- 支持批量处理和GPU加速
- 内置内存优化和错误处理机制
- 详细的日志记录系统

## 系统要求

- Python 3.8+
- CUDA支持（推荐）
- 8GB+ RAM
- 20GB+ 磁盘空间

## 安装说明

1. 克隆项目到本地
2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 如果需要GPU支持，请安装FAISS的GPU版本：
```bash
pip uninstall faiss-cpu
pip install faiss-gpu
```

## 使用方法

1. 准备数据：
   - 将药品数据文件放在 `drug/` 目录下
   - 确保评估数据集 `eval.csv` 在当前目录

2. 运行评估：
```bash
python embedding.py
```

3. 查看结果：
   - 评估结果将保存在 `gte_Qwen2-1.5B-instruct.csv`
   - 日志文件保存在 `embedding_debug.log`

## 文件结构

```
.
├── embedding.py          # 主程序
├── requirements.txt      # 依赖配置
├── README.md            # 说明文档
├── drug/                # 药品数据目录
│   ├── drug1.csv
│   ├── drug2.csv
│   └── ...
├── eval.csv             # 评估数据集
└── embedding_debug.log  # 运行日志
```

## 配置说明

- 向量模型：gte_Qwen2-1.5B-instruct
  - 向量维度：1536
  - 最大Token长度：8192
- FAISS索引类型：IndexFlatL2
- 批处理大小：8（可根据显存大小调整）

## 注意事项

1. 内存使用：
   - 程序会自动进行内存优化
   - 如果出现OOM，可以减小批处理大小

2. GPU使用：
   - 程序会自动检测并使用可用的GPU
   - 可以通过环境变量控制GPU使用

3. 数据格式：
   - 药品数据文件需要是CSV格式
   - 评估数据集需要包含指定的列名

## 常见问题

1. 内存不足：
   - 减小batch_size
   - 使用GPU版本
   - 清理不必要的进程

2. GPU相关：
   - 确保CUDA正确安装
   - 检查GPU驱动版本
   - 监控GPU内存使用

## 更新日志

- 2024.01: 
  - 从sklearn迁移到FAISS
  - 更新为gte_Qwen2-1.5B-instruct模型
  - 添加内存优化机制

## 联系方式

如有问题，请提交Issue或Pull Request。 